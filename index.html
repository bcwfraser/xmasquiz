<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>World Cup 2026 – Venue Quiz</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
  * { box-sizing: border-box; }

  body {
    margin: 0;
    padding: 12px;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    background: #f5f5f5;
  }

  h1 {
    margin: 0 0 8px;
    font-size: 20px;
  }

  .container {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    align-items: flex-start;
  }

  /* Fixed-size map so pins don't move when layout changes */
  #map-wrapper {
    position: relative;
    width: 360px;
    aspect-ratio: 1802 / 2048;
    background: #ffffff;
    border: 1px solid #cccccc;
    border-radius: 4px;
    overflow: hidden;
    touch-action: none;
  }

  #map-image {
    position: absolute;
    inset: 0;
    background-image: url("blank-north-america.png");
    background-size: 100% 100%;
    background-position: center;
    background-repeat: no-repeat;
  }

  .marker {
    position: absolute;
    width: 30px;
    height: 30px;
    border-radius: 50%;
    background: #c0392b;
    color: #ffffff;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    font-size: 14px;
    cursor: grab;
    user-select: none;
    transform: translate(-50%, -50%);
    box-shadow: 0 0 4px rgba(0, 0, 0, 0.5);
    touch-action: none;
    -webkit-tap-highlight-color: transparent;
  }

  .marker.dragging {
    opacity: 0.75;
    cursor: grabbing;
  }

  .marker.locked {
    cursor: default;
  }

  .correct-marker {
    position: absolute;
    width: 14px;
    height: 14px;
    border-radius: 50%;
    background: rgba(0, 180, 0, 0.9);
    border: 2px solid #ffffff;
    transform: translate(-50%, -50%);
    box-shadow: 0 0 4px rgba(0, 0, 0, 0.6);
    pointer-events: none;
  }

  #marker-info {
    position: absolute;
    max-width: 220px;
    padding: 6px 8px;
    font-size: 12px;
    color: #ffffff;
    background: rgba(0, 0, 0, 0.85);
    border-radius: 4px;
    pointer-events: none;
    transform: translate(-50%, -110%);
    z-index: 20;
    display: none;
  }

  #marker-info::after {
    content: "";
    position: absolute;
    left: 50%;
    bottom: -6px;
    transform: translateX(-50%);
    border-width: 6px 6px 0 6px;
    border-style: solid;
    border-color: rgba(0,0,0,0.85) transparent transparent transparent;
  }

  #controls {
    flex: 1 1 220px;
    max-width: 320px;
    padding: 10px 12px;
    background: #ffffff;
    border-radius: 4px;
    border: 1px solid #dddddd;
    font-size: 14px;
  }

  #controls h2 {
    margin: 0 0 6px;
    font-size: 18px;
  }

  #controls p {
    margin: 4px 0;
  }

  button {
    display: inline-block;
    margin: 4px 4px 8px 0;
    padding: 6px 10px;
    font-size: 14px;
    border-radius: 4px;
    border: 1px solid #888888;
    background: #ffffff;
    cursor: pointer;
  }

  button:disabled {
    opacity: 0.5;
    cursor: default;
  }

  #score {
    font-weight: 600;
    margin-top: 4px;
  }

  #status-log {
    margin-top: 10px;
    max-height: 260px;
    overflow-y: auto;
    border-top: 1px solid #eeeeee;
    padding-top: 6px;
    font-size: 13px;
  }

  #status-log div {
    margin-bottom: 4px;
  }

  .hint {
    font-size: 12px;
    color: #666666;
  }

  @media (max-width: 600px) {
    #controls {
      max-width: 100%;
    }
  }
</style>
</head>
<body>

<h1>World Cup 2026 – Venue Quiz</h1>

<div class="container">
  <div id="map-wrapper">
    <div id="map-image"></div>
    <div id="marker-info"></div>
  </div>

  <div id="controls">
    <h2>Instructions</h2>
    <p>Drag each numbered circle onto the map where you think that World Cup stadium (or player) is.</p>
    <p class="hint">
      Tap a marker to see its label. When everyone is done, press “Start reveal” and then “Reveal next”.
      A point is awarded if the guess is within about 150 miles.
    </p>

    <button id="start-reveal">Start reveal</button>
    <button id="next-answer" disabled>Reveal next</button>

    <div id="score">Score: 0 / 20</div>
    <p class="hint">Distances are approximate, based on the scale of this drawing.</p>

    <div id="status-log"></div>
  </div>
</div>

<script>
  const MILES_THRESHOLD = 150;
  const MILES_PER_PIXEL = 2.5;

  const answers = [
    { id: 1,  label: "BC Place: Vancouver",                       relX: 0.272222, relY: 0.481301 },
    { id: 2,  label: "Lumen Field: Seattle",                      relX: 0.266667, relY: 0.515447 },
    { id: 3,  label: "Levi's Stadium: Santa Clara",               relX: 0.233333, relY: 0.626829 },
    { id: 4,  label: "SoFi Stadium: Los Angeles",                 relX: 0.261111, relY: 0.659350 },
    { id: 5,  label: "Estadio Akron: Guadalajara",                relX: 0.400000, relY: 0.816260 },
    { id: 6,  label: "Estadio Azteca: Mexico City",               relX: 0.450000, relY: 0.843089 },
    { id: 7,  label: "Estadio BBVA: Monterrey",                   relX: 0.438889, relY: 0.752846 },
    { id: 8,  label: "AT&T Stadium: Arlington (Dallas)",          relX: 0.477778, relY: 0.670732 },
    { id: 9,  label: "NRG Stadium: Houston",                      relX: 0.494444, relY: 0.726016 },
    { id: 10, label: "GEHA Field at Arrowhead Stadium: Kansas City", relX: 0.497222, relY: 0.603252 },
    { id: 11, label: "Mercedes-Benz Stadium: Atlanta",            relX: 0.616667, relY: 0.652846 },
    { id: 12, label: "Hard Rock Stadium: Miami Gardens",          relX: 0.666667, relY: 0.750407 },
    { id: 13, label: "BMO Field: Toronto",                        relX: 0.619444, relY: 0.529268 },
    { id: 14, label: "Gillette Stadium: Foxborough (Boston)",     relX: 0.705556, relY: 0.565041 },
    { id: 15, label: "Lincoln Financial Field: Philadelphia",     relX: 0.677778, relY: 0.602439 },
    { id: 16, label: "MetLife Stadium: East Rutherford",          relX: 0.705556, relY: 0.556098 },

    { id: 17, label: "Guillermo Ochoa",                           relX: 0.450000, relY: 0.843089 }, // Azteca
    { id: 18, label: "Miguel Almirón",                            relX: 0.616667, relY: 0.652846 }, // Mercedes-Benz
    { id: 19, label: "Jermaine Defoe",                            relX: 0.619444, relY: 0.529268 }, // BMO Field
    { id: 20, label: "Mutch / Reo-Coker / Beardsley",             relX: 0.272222, relY: 0.481301 }  // Vancouver
  ];

  document.addEventListener("DOMContentLoaded", function () {
    const mapWrapper     = document.getElementById("map-wrapper");
    const startRevealBtn = document.getElementById("start-reveal");
    const nextAnswerBtn  = document.getElementById("next-answer");
    const scoreEl        = document.getElementById("score");
    const statusLog      = document.getElementById("status-log");
    const infoBox        = document.getElementById("marker-info");

    const markers = [];
    let draggingMarker = null;
    let dragEnabled = true;
    let revealIndex = 0;
    let score = 0;
    let activeInfoMarkerId = null;

    createMarkers();
    scoreEl.textContent = "Score: " + score + " / " + answers.length;

    startRevealBtn.addEventListener("click", function () {
      dragEnabled = false;
      startRevealBtn.disabled = true;
      nextAnswerBtn.disabled = false;
      lockMarkers();
      addStatus("Reveal started. Click “Reveal next” for each location.");
      hideInfoBox();
    });

    nextAnswerBtn.addEventListener("click", function () {
      hideInfoBox();
      revealNextAnswer();
    });

    mapWrapper.addEventListener("pointerdown", function (ev) {
      if (!ev.target.classList.contains("marker")) {
        hideInfoBox();
      }
    });

    function createMarkers() {
      const rect = mapWrapper.getBoundingClientRect();

      const cols = 2;
      const rows = Math.ceil(answers.length / cols);
      const topN = 0.1;
      const bottomN = 0.9;
      const usableN = bottomN - topN;
      const rowSpacingN = usableN / Math.max(rows, 1);

      answers.forEach(function (answer, index) {
        const el = document.createElement("div");
        el.className = "marker";
        el.textContent = String(answer.id);
        el.dataset.id = String(answer.id);

        const col = index % cols;
        const row = Math.floor(index / cols);

        const nx = 0.9 - col * 0.06;
        const ny = topN + rowSpacingN * (row + 0.5);

        const x = nx * rect.width;
        const y = ny * rect.height;

        el.style.left = x + "px";
        el.style.top = y + "px";

        mapWrapper.appendChild(el);

        const markerData = {
          id: answer.id,
          element: el,
          relX: nx,
          relY: ny,
          hasGuess: false,
          info: answer.label
        };

        markers.push(markerData);
        attachPointerHandlers(markerData);
      });
    }

    function attachPointerHandlers(markerData) {
      const el = markerData.element;

      let isPointerDown = false;
      let pointerId = null;
      let startClientX = 0;
      let startClientY = 0;
      let moved = false;

      el.addEventListener("pointerdown", function (ev) {
        isPointerDown = true;
        pointerId = ev.pointerId;
        startClientX = ev.clientX;
        startClientY = ev.clientY;
        moved = false;

        if (dragEnabled) {
          draggingMarker = markerData;
          el.classList.add("dragging");
          el.setPointerCapture(ev.pointerId);
        }
      });

      el.addEventListener("pointermove", function (ev) {
        if (!isPointerDown) return;

        const dx = ev.clientX - startClientX;
        const dy = ev.clientY - startClientY;
        if (Math.abs(dx) > 3 || Math.abs(dy) > 3) {
          moved = true;
        }

        if (!dragEnabled || draggingMarker !== markerData) return;

        const rect = mapWrapper.getBoundingClientRect();
        let x = ev.clientX - rect.left;
        let y = ev.clientY - rect.top;

        if (x < 0) x = 0;
        if (y < 0) y = 0;
        if (x > rect.width) x = rect.width;
        if (y > rect.height) y = rect.height;

        markerData.relX = x / rect.width;
        markerData.relY = y / rect.height;
        markerData.hasGuess = true;

        el.style.left = x + "px";
        el.style.top = y + "px";

        hideInfoBox();
      });

      el.addEventListener("pointerup", function () {
        if (!isPointerDown) return;
        isPointerDown = false;

        if (dragEnabled && draggingMarker === markerData) {
          draggingMarker = null;
          el.classList.remove("dragging");
          try {
            el.releasePointerCapture(pointerId);
          } catch (e) {}
        }

        if (!moved) {
          toggleMarkerInfo(markerData);
        }
      });

      el.addEventListener("pointercancel", function () {
        if (!isPointerDown) return;
        isPointerDown = false;

        if (dragEnabled && draggingMarker === markerData) {
          draggingMarker = null;
          el.classList.remove("dragging");
          try {
            el.releasePointerCapture(pointerId);
          } catch (e) {}
        }
      });
    }

    function toggleMarkerInfo(markerData) {
      if (!markerData.info) {
        hideInfoBox();
        return;
      }
      if (activeInfoMarkerId === markerData.id) {
        hideInfoBox();
        return;
      }
      showInfoBox(markerData);
    }

    function showInfoBox(markerData) {
      const el = markerData.element;
      const left = parseFloat(el.style.left) || 0;
      const top = parseFloat(el.style.top) || 0;

      infoBox.textContent = markerData.info;
      infoBox.style.left = left + "px";
      infoBox.style.top = top + "px";
      infoBox.style.display = "block";
      activeInfoMarkerId = markerData.id;
    }

    function hideInfoBox() {
      infoBox.style.display = "none";
      activeInfoMarkerId = null;
    }

    function lockMarkers() {
      markers.forEach(function (m) {
        m.element.classList.add("locked");
      });
      dragEnabled = false;
    }

    function revealNextAnswer() {
      if (revealIndex >= answers.length) {
        nextAnswerBtn.disabled = true;
        return;
      }

      const answer = answers[revealIndex];
      const marker = markers.find(function (m) { return m.id === answer.id; });
      const rect = mapWrapper.getBoundingClientRect();

      const correctX = answer.relX * rect.width;
      const correctY = answer.relY * rect.height;

      const correctEl = document.createElement("div");
      correctEl.className = "correct-marker";
      correctEl.style.left = correctX + "px";
      correctEl.style.top = correctY + "px";
      correctEl.title = answer.label;
      mapWrapper.appendChild(correctEl);

      let message;
      if (marker && marker.hasGuess) {
        const guessX = marker.relX * rect.width;
        const guessY = marker.relY * rect.height;
        const dx = guessX - correctX;
        const dy = guessY - correctY;
        const pixelDist = Math.hypot(dx, dy);
        const miles = pixelDist * MILES_PER_PIXEL;
        const rounded = Math.round(miles);

        if (miles <= MILES_THRESHOLD) {
          score += 1;
          message =
            "#" + answer.id + " (" + answer.label + "): " +
            rounded + " miles away – point awarded.";
        } else {
          message =
            "#" + answer.id + " (" + answer.label + "): " +
            rounded + " miles away – no point.";
        }
      } else {
        message =
          "#" + answer.id + " (" + answer.label + "): " +
          "no guess placed.";
      }

      addStatus(message);
      scoreEl.textContent = "Score: " + score + " / " + answers.length;

      revealIndex += 1;
      if (revealIndex >= answers.length) {
        nextAnswerBtn.disabled = true;
        addStatus("All answers revealed.");
      }
    }

    function addStatus(text) {
      const line = document.createElement("div");
      line.textContent = text;
      statusLog.prepend(line);
    }
  });
</script>

</body>
</html>
